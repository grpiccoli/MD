function isNullOrWhitespace(n){return typeof n=="undefined"||n==null?!0:n.replace(/\s/g,"").length<1}function min(n){return Math.min.apply(Math,n)}function getContent(n){for(var i=$(places[n].card),r=$(i.find(".card-title")[0]).removeClass("activator").attr("onclick",null).append('<i class="material-icons right">close<\/i>')[0].outerHTML,u=i.find(".tab > a"),f=i.find(".tab-content"),t=0;t<u.length;t++)r+="<h6>"+u[t].innerHTML+"<\/h6>",r+=f[t].innerHTML;return r}function book(n){$.ajax({type:"POST",url:"./Reservation",data:{id:n,__RequestVerificationToken:$("input[name='__RequestVerificationToken']").val()},success:function(n){window.location.href=n}})}function agendar2(n){var r=$("#MinDate").val(),u=$("#Last").val(),f=moment(u).toDate().getFullYear(),t,i;r=isNullOrWhitespace(r)?moment(dateToday).format(ASPNETDateFormat):moment(r).format(ASPNETDateFormat);t=$("#MaxDate").val();t=isNullOrWhitespace(t)?moment(u).format(ASPNETDateFormat):moment(t).format(ASPNETDateFormat);i=$(places[n].card).removeClass("m6").removeClass("l4");i.find(".card-reveal, .card-action, .tab:first, .time").remove();i.find(".activator").attr("onclick",null).removeClass("activator");i.find(".card").addClass("m-0");$("#date-details").html(i[0].outerHTML);$.post("/Patients/Search/GetDates",{__RequestVerificationToken:$("input[name='__RequestVerificationToken']").val(),mdId:n,minDate:r,maxDate:t},function(t){var i=M.Datepicker.init(document.getElementById("Date"),{firstDay:1,autoClose:!0,minDate:dateToday,showDaysInNextAndPreviousMonths:!0,maxDate:new Date($("#Last").val()),defaultDate:moment(min(t),"YYYYMMDD").toDate(),yearRange:[yr,f],setDefaultDate:!0,disableDayFn:function(n){var i=parseInt(moment(n,moment.ISO_8601).format("YYYYMMDD"));return t.indexOf(i)===-1},i18n:{months:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthsShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Set","Oct","Nov","Dic"],weekdays:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],weekdaysShort:["Dom","Lun","Mar","Mie","Jue","Vie","Sab"],weekdaysAbbrev:["D","L","M","M","J","V","S"],cancel:"Cancelar",clear:"Limpiar",done:"Ok"},onSelect:function(t){$("#dateDetails").html(moment(t).format("dddd DD [de] MMMM, YYYY"));var i=moment(t,moment.ISO_8601).format(ASPNETDateFormat);$.post("/Patients/Search/TimeSlots",{__RequestVerificationToken:$("input[name='__RequestVerificationToken']").val(),startDate:i,mdId:n},function(n){var t="",i="";$.each(n,function(n,r){var u="<tr>"+("<td>"+r.startTime+"<\/td>")+"<td>"+('<button class="time-select btn clinic-desc" data-id="'+r.id+'" class="btn waves-effect waves-teal right-align">SELECCIONAR<\/button>')+"<\/td><\/tr>";~r.startTime.indexOf("a.")?t+=u:i+=u});mañanaTable="<table>"+t+"<\/table>";$("#BookingMorning").html(mañanaTable);tardeTable="<table>"+i+"<\/table>";$("#BookingAfternoon").html(tardeTable);M.Sidenav.getInstance(document.getElementById("slide-action")).close();$("#map-view").slideUp();$("#list-view").slideUp();$("#date-view").slideDown();$("#toggle-view").html("ver mapa");$("#date-view button.time-select").click(function(){book($(this).data("id"))});M.Tabs.init(document.querySelectorAll("#date-view .tabs"));M.Tooltip.init(document.querySelectorAll("#date-view .tooltipped"))})}});return i.open(),!1})}function agendar(n,t){var r=$("#Insurance, #Ubicacion").serialize(),u=$("#MinDate,#MaxDate").serializeArray(),i=[r];return i.push("MdId="+t),i.push("Last="+$("#Last").val()),u.forEach(function(n){n.value!==""&&i.push(n.name+"="+moment(n.value).format(ASPNETDateFormat))}),window.location.href="/Patients/Search/DoctorDetails/"+n+"?"+i.join("&"),!1}function fillReveal(n){$("#"+n+"reveal").html(getContent(n))}function initMap(){function e(){for(var f,r=new google.maps.LatLngBounds,i=0,u=n;i<u.length;i++)f=u[i],r.extend(f.getPosition());t.fitBounds(r)}function a(n,t){google.maps.event.addListener(n,"click",function(){$("#slide-header").html(places[t].header);$("#slide-content").html(places[t].content);document.querySelectorAll("#slide-action div.card-tabs, #slide-action ul").forEach(function(n){n.addEventListener("touchstart",function(){o.options.draggable=!1});n.addEventListener("touchend",function(){o.options.draggable=!0})});setTimeout(function(){o.open();M.Tabs.init(document.querySelectorAll("#slide-action .tabs"));M.Tooltip.init(document.querySelectorAll("#slide-action .tooltipped"))},500)})}function v(t){for(var u,i=0,r=n;i<r.length;i++)u=r[i],u.setMap(t)}function y(){v(null)}function p(){y();n=[]}function w(n){return n.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1.")}function b(n,t){var u='<div id="'+n.cardId+'sp" class="tab-content esp">',s="",i='<div id="'+n.cardId+'insr" class="tab-content mis">',v='<li class="tab"><a class="mis" href="#'+n.cardId+'insr">Convenios<\/a><\/li>',y='<li class="tab"><a class="esp" href="#'+n.cardId+'sp">Especialidad<\/a><\/li>',h,r,f,c,e,a,o;if(n.insurances.length!==0){for(h=n.insurances.length>1?"s":"",i+="<label>Convenio"+h+":<\/label><ul>",r=0,f=n.insurances;r<f.length;r++)c=f[r],e=l[c],i+='<li><a class="btn tooltipped" data-tooltip="'+e+'"><img src="/img/mi/'+e+'-icon.min.png"/><\/a><\/li>';i+="<\/ul>"}return i+="<\/div>",n.especialidad!==null&&(s="Dr"+(n.sex?"":"a")+". ",u+="<label>Esp.<\/label><span>"+n.especialidad+"<\/span>"),a=""+s+n.dr,u+="<\/div>",o='<p class="address">'+t.name+"<br/>"+t.address,o+=isNullOrWhitespace(n.office)?"<\/p>":"<br/><span>"+n.office+"<\/span><\/p>","<div id="+n.cardId+' class="col s12 m6 l4"><div class="card horizontal sticky-action"><div class="card-image">'+('<img src="/img/doc/'+n.run+'.min.jpg"/>')+'<\/div><div class="card-stacked"><div class="card-content">'+('<span class="card-title activator" onclick="fillReveal('+n.cardId+')">'+a+"<\/span>")+'<\/div><div class="card-tabs"><ul class="tabs tabs-fixed-width">'+('<li class="tab"><a class="time" href="#'+n.cardId+'next">Prox. Hora<\/a><\/li>')+('<li class="tab"><a class="addr" href="#'+n.cardId+'addr">Dirección<\/a><\/li>')+('<li class="tab"><a class="price" href="#'+n.cardId+'prce">Valor Particular<\/a><\/li>')+v+y+'<\/ul><\/div><div class="card-content grey lighten-4">'+('<div id="'+n.cardId+'next" class="tab-content time">'+n.nextTS.hora+'<br/><a href="#" onclick="book('+n.nextTS.id+')">AGENDAR<\/a><\/div>')+('<div id="'+n.cardId+'addr" class="tab-content addr">'+o+"<\/div>")+('<div id="'+n.cardId+'prce" class="tab-content price"><span><i class="material-icons left">attach_money<\/i>'+w(n.price)+"<\/span><\/div>")+i+u+'<\/div><div class="card-action center">'+('<a href="#" onclick="agendar2('+n.cardId+')"><i class="material-icons">add<\/i>Otra Fecha/Hr<\/a>')+"<\/div><\/div>"+('<div id="'+n.cardId+'reveal" class="card-reveal">')+"<\/div><\/div><\/div>"}function k(i){i.place.cId in places||(places[i.place.cId]={},places[i.place.cId].header='<div class="col s12 m6"><div class="card m-0"><div class="card-image">'+('<img class="activator placeimg" src="https://maps.googleapis.com/maps/api/place/photo?maxwidth=300&photoreference='+i.place.photoId+'&key=AIzaSyDkCLRdkB6VyOXs-Uz_MFJ8Ym9Ji1Xp3rA">')+('<span class="card-title activator"><b>'+i.place.name+"<\/b><\/span>")+'<\/div><div class="card-content"><span class="card-title activator grey-text text-darken-4">Ver detalles<i class="material-icons right">more_vert<\/i><\/span><\/div><div class="card-reveal">'+('<span class="card-title grey-text text-darken-4">'+i.place.name+'<i class="material-icons right">close<\/i><\/span>')+("<p><b>Dirección<\/b>: "+i.place.address+'.<a href="https://maps.google.com/?cid='+i.place.cId+'"><i class="material-icons">location_on<\/i><\/a><\/p>')+"<\/div><\/div><\/div><\/div>",places[i.place.cId].list='<div class="col s12"><h5>'+i.place.name+"<\/h5><p>"+i.place.address+'<\/p><hr/><\/div><div id="'+i.place.cId+'" class="list-place"><\/div>');$("#list").append(places[i.place.cId].list);var r=0,f=.5,e="";$.each(i.items,function(){this.dr in u||(u[this.dr]="/img/doc/"+this.run+".min.jpg");var n=b(this,i.place);this.cardId.toString()in places||(places[this.cardId.toString()]={},places[this.cardId.toString()].card=n);e+=n;r++;f===.5&&this.match&&(f=1)});places[i.place.cId].content=e;var o=new google.maps.Marker({position:new google.maps.LatLng({lat:i.place.latitude,lng:i.place.longitude}),map:t,title:i.place.name+"\n"+i.place.address,icon:"https://chart.apis.google.com/chart?chst=d_map_spin&chld=1|0|1d999e|16|b|"+r,zIndex:r,opacity:f});n.push(o);a(o,i.place.cId)}function d(r){var f=r.length;f===0&&(loaderStop(),$("button").removeAttr("disabled"),alert("No hay resultados para los filtros seleccionados"),typeof i!="undefined"&&i.clearMarkers());$("#list").empty();u={};$.each(r,function(){var r,o;k(this);--f||(e(),loaderStop(),$("#map-controls").show(),$("button").removeAttr("disabled"),$("#search-filter").prop("disabled",!1),r=document.getElementById("search-filter"),M.Autocomplete.init(r,{data:u,limit:10,onAutocomplete:function(n){var t=parseInt(u[n].replace(/.*\//g,"").replace(/\..*/g,""));agendar(t,null)}}),$("#close-search").click(function(){$(r).val("")}),typeof i!="undefined"&&i.clearMarkers(),o={gridSize:40,imagePath:"/img/cluster/m"},i=new MarkerClusterer(t,n,o),i.setCalculator(function(n){for(var f,t=1,i=0,r=0,u=n;r<u.length;r++)f=u[r],i+=f.getZIndex();return t=Math.round(Math.log(i/4)),t>5&&(t=5),{text:i,index:t}}))})}function g(){var n=$("#filter input[name='__RequestVerificationToken'],#Insurance, #Ubicacion, #Especialidad, #Sex, #HighlightInsurance").serializeArray(),t=$("#MinDate,#MaxDate").serializeArray();return t.forEach(function(t){t.value!==""&&n.push({name:t.name,value:moment(t.value).format(ASPNETDateFormat)})}),n}function h(){loaderStart();$("#search-filter").prop("disabled",!0);$("#map-controls").hide();$("button").prop("disabled",!0);$.post("/Patients/Search/MapList",g(),d)}function nt(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(i){var r=t.getBounds(),u=new google.maps.LatLng(i.coords.latitude,i.coords.longitude);s=new google.maps.Marker({position:u,map:t,title:"Mi posición actual",icon:"https://chart.apis.google.com/chart?chst=d_map_xpin_icon&chld=pin_star|wc-male|042037|2A4F6E"});n.push(s);r.extend(u);t.fitBounds(r)})}function tt(){f&&(p(),h(),f=!1)}function c(n){var i=$(n.target).attr("id"),r=i,t=$(n.target).select2("data"),u;t.length>0&&(u=t.length>1?" +"+(t.length-1):"",r=t[0].text.substring(0,8)+"&hellip;"+u);$("#btn"+i).html(r);f=!0}var l=["Particular","FONASA","Banmédica","Colmena","Consalud","CruzBlanca","Nueva Masvida","Vida Tres"],n=[],i,t=new google.maps.Map(document.getElementById("map"),{mapTypeControl:!1,scaleControl:!0,streetViewControl:!1,fullscreenControl:!1,gestureHandling:"greedy",zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER}}),o=M.Sidenav.init(document.getElementById("slide-action"),{draggable:!0,onCloseEnd:function(){[].forEach.call(document.querySelectorAll("#slide-action .tabs"),function(n){M.Tabs.getInstance(n).destroy()});[].forEach.call(document.querySelectorAll("#slide-action .tooltipped"),function(n){M.Tooltip.getInstance(n).destroy()})}}),u,s,f,r;h();document.getElementById("toggle-center").onclick=function(){var t=document.querySelector("#toggle-center i");t.innerHTML=="location_off"?(t.innerHTML="location_on",nt()):(t.innerHTML="location_off",n.pop(),s.setMap(null),e())};document.getElementById("re-center").onclick=function(){e();document.querySelector("#re-center > i").innerHTML="my_location"};google.maps.event.addListener(t,"dragend",function(){document.querySelector("#re-center > i").innerHTML="location_disabled"});$("#toggle-view").click(function(){$("#date-view").slideUp();$("#map-view").css("display")==="block"?($(this).html("ver mapa"),$.each(places,function(n){$("#"+n).html(this.content)}),M.Tooltip.init(document.querySelectorAll("#list .tooltipped")),$("#map-view").slideUp(),$("#list-view").slideDown(),M.Tabs.init(document.querySelectorAll("#list .tabs"))):($("#map-view").slideDown(),$("#list-view").slideUp(),$(this).html("ver lista"),setTimeout(e,400),setTimeout(function(){[].forEach.call(document.querySelectorAll("#list .tabs"),function(n){M.Tabs.getInstance(n).destroy()});[].forEach.call(document.querySelectorAll("#list .tooltipped"),function(n){M.Tooltip.getInstance(n).destroy()});$("#list .list-place").html("")},200))});f=!1;r=M.Modal.init(document.getElementById("filters-pane"),{onCloseStart:tt});$(".filter-action").click(function(n){n.preventDefault();r.close()});$("#filter-clear").click(function(n){n.preventDefault();window.location.reload()});$("#filter input").change(function(){f=!0});$(".fltbtn").click(function(n){var t=$(n.target).attr("id");switch(t){case"btnEspecialidad":$(".fltcol").hide();r.open();$("#especialities-col").fadeIn();$("#especialities-col input.select2-search__field").trigger("keyup");$("sel2open").select2("close");break;case"btnUbicacion":$(".fltcol").hide();r.open();$("#locations-col").fadeIn();$("#locations-col input.select2-search__field").trigger("keyup");$("sel2open").select2("close");break;case"btnFechaHora":$(".fltcol").hide();r.open();$("#dates-col").fadeIn();$("#dates-col input.select2-search__field").trigger("keyup");$("sel2open").select2("close");break;case"all1":case"all2":r.open();$(".fltcol").fadeIn();$("#filters-pane input.select2-search__field").trigger("keyup");$("sel2open").select2("close")}new SimpleBar(document.querySelector(".filters-controls"))});$.post("/Patients/Search/FilterLists",$("#filter input[name='__RequestVerificationToken']").serializeArray(),function(n){$("#Especialidad").select2({theme:"material",placeholder:"Seleccione especialidades",data:n.esp}).change(c);$("#Ubicacion").select2({theme:"material",placeholder:"Seleccione ubicaciones",data:n.loc}).change(c);$("#Sex").select2({theme:"material",maximumSelectionLength:1,placeholder:"Seleccione sexo del profesional médico"});$("input.select2-search__field").addClass("browser-default")})}var dateToday=new Date,yr=dateToday.getFullYear(),mañanaTable,tardeTable,ASPNETDateFormat="YYYY-MM-DDTHH:mm:ss.000",places={};document.addEventListener("DOMContentLoaded",function(){function n(n,t,i){$("#MinDate").val(t.format(ASPNETDateFormat)).change();$("#MaxDate").val(i.format(ASPNETDateFormat)).change()}var t,i;M.FloatingActionButton.init(document.getElementById("filter-options"),{toolbarEnabled:!0});t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Nexus/i.test(navigator.userAgent)?1:2;$("#fl-item-9").calentim({format:"dddd DD MMMM, YYYY h:mm A",locale:"es",inline:!0,startOnMonday:!0,startDate:moment().startOf("day"),minDate:moment().startOf("day"),endDate:moment($("#Last").val()).endOf("day"),maxDate:moment($("#Last").val()).endOf("day"),rangeLabel:"Rangos",cancelLabel:"Cancelar",calendarCount:t,applyLabel:"Filtrar",hideOutOfRange:!0,ranges:[{title:"Hoy",startDate:moment(),endDate:moment()},{title:"Próximos 3 dias",startDate:moment(),endDate:moment().add(3,"days")},{title:"Próximos 5 dias",startDate:moment(),endDate:moment().add(5,"days")},{title:"Próximos 7 dias",startDate:moment(),endDate:moment().add(7,"days")},{title:"Próxima semana",startDate:moment().day(7),endDate:moment().day(7).add(1,"days").day(7)},{title:"Hasta el próximo mes",startDate:moment(),endDate:moment().add(1,"month").endOf("month")}],ontimechange:n,onafterselect:n});$(window).on("resize",function(){var n=$(window).width();n>610?$(".calentim-container-mobile").removeClass("calentim-container-mobile").addClass("calentim-container"):$(".calentim-container").removeClass("calentim-container").addClass("calentim-container-mobile")});i=["time","addr","price","mis","esp"];M.Modal.init(document.getElementById("select-modal"));$("#example-picker").picker({data:["Próx. Hora Disponible","Dirección","Valor particular","Convenios","Especialidad médica"]},function(){var n=Math.round($(".clone-scroller").scrollTop()/30),u=$($(".picker-scroller").find(".option").get(n)).html(),r,t;$("#tab-shown").html(u);$("li.tab a").removeClass("active");r=$("li.tab a."+i[n]).addClass("active");t=0;n>2&&(t+=200);r.parent().parent().animate({scrollLeft:t});M.Tabs.init(document.querySelectorAll(".tabs"))})});