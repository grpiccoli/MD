function agendar(n,t){var u=$("#Insurance, #Ubicacion, #MinTime, #MaxTime").serialize(),f=$("#MinDate,#MaxDate").serializeArray(),i=[u],r;return i.push("placeId="+t),i.push("Last="+$("#Last").val()),f.forEach(function(n){n.value!==""&&i.push(n.name+"="+moment(n.value,momentFormat).toJSON().replace("Z",""))}),r=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],r.forEach(function(n){var t=$("#"+n).prop("checked");typeof t!="undefined"&&i.push(n+"="+t)}),window.location.href="/Patients/Search/DoctorDetails/"+n+"?"+i.join("&"),!1}function initMap(){function e(){for(var i=new google.maps.LatLngBounds,t=0;t<n.length;t++)i.extend(n[t].getPosition());r.fitBounds(i)}function y(n,i){google.maps.event.addListener(n,"click",function(){$("#slide-header").html(t[i].header);$("#slide-content").html(t[i].content);$("#slide-action").sidenav("open")})}function p(t){for(var i=0;i<n.length;i++)n[i].setMap(t)}function w(){p(null)}function b(){w();n=[]}function k(n){return n.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1.")}function d(n){return typeof n=="undefined"||n==null?!0:n.replace(/\s/g,"").length<1}function g(n,t){var i="",r,u;if(n.insurances.length!==0){for(i+="<label>Convenio"+(n.insurances.length>1?"s":"")+":<\/label><ul>",r=0;r<n.insurances.length;r++)u=v[n.insurances[r]],i+='<li><img src="/img/mi/'+u+'-icon.min.png"/>'+u+"<\/li>";i+="<\/ul><hr/>"}var f=n.especialidad!==null,e=f?"Dr"+(n.sex?"":"a")+".":"",o=f?"<li><label>Esp.<\/label><span>"+n.especialidad+"<\/span><\/li>":"",s=d(n.office)?"":"<li><label>Of.<\/label><span>"+n.office+"<\/span><\/li>";return'<div class="col s12 m6 l4"><div class="card horizontal sticky-action">'+('<div class="card-image"><img src="/img/doc/'+n.run+'.min.jpg"/><\/div>')+'<div class="card-stacked"><div class="card-content">'+('<span class="card-title activator">'+e+" "+n.dr+"<\/span>")+("<ul>"+o+s+"<\/ul><hr/>")+'<span class="card-title activator"><i class="material-icons left">add<\/i>Más info<\/span><\/div><div class="card-action center">'+('<a href="#" onclick="agendar('+n.run+",'"+t+"')\">Agendar<\/a>")+'<\/div><\/div><div class="card-reveal">'+('<span class="card-title"><i class="material-icons right">close<\/i>'+e+" "+n.dr+"<\/span>")+i+"<label>Valor Particular:<\/label>"+("<span>$"+k(n.price)+"<\/span>")+"<\/div><\/div><\/div>"}function nt(i){i.place.cId in t||(t[i.place.cId]={},t[i.place.cId].header='<div class="col s12 m6"><div class="card m-0"><div class="card-image">'+('<img class="activator placeimg" src="https://maps.googleapis.com/maps/api/place/photo?maxwidth=300&photoreference='+i.place.photoId+'&key=AIzaSyDkCLRdkB6VyOXs-Uz_MFJ8Ym9Ji1Xp3rA">')+('<span class="card-title activator"><b>'+i.place.name+"<\/b><\/span>")+'<\/div><div class="card-content"><span class="card-title activator grey-text text-darken-4">Ver detalles<i class="material-icons right">more_vert<\/i><\/span><\/div><div class="card-reveal">'+('<span class="card-title grey-text text-darken-4">'+i.place.name+'<i class="material-icons right">close<\/i><\/span>')+("<p><b>Dirección<\/b>: "+i.place.address+'.<a href="https://maps.google.com/?cid='+i.place.cId+'"><i class="material-icons">location_on<\/i><\/a><\/p>')+"<\/div><\/div><\/div><\/div>");$("#list").append('<div class="col s12"><h5>'+i.place.name+"<\/h5><p>"+i.place.address+'<\/p><hr/><\/div><div id="'+i.place.cId+'"><\/div>');var u=0,f=.5,e="";$.each(i.items,function(n,t){var r=g(t,i.place.id);e+=r;u++;f===.5&&t.match&&(f=1)});t[i.place.cId].content=e;var o=new google.maps.Marker({position:new google.maps.LatLng({lat:i.place.latitude,lng:i.place.longitude}),map:r,title:i.place.name+"\n"+i.place.address,icon:"https://chart.apis.google.com/chart?chst=d_map_spin&chld=1|0|1d999e|16|b|"+u,zIndex:u,opacity:f});n.push(o);y(o,i.place.cId)}function tt(t){var u=t.length;u===0&&(loaderStop(),alert("No hay resultados para los filtros seleccionados"),typeof i!="undefined"&&i.clearMarkers());$("#list").empty();$.each(t,function(t,f){if(nt(f),!--u){typeof i!="undefined"&&i.clearMarkers();i=new MarkerClusterer(r,n,{gridSize:40,imagePath:"/img/cluster/m"});i.setCalculator(function(n){for(var t=1,i=0,r=0;r<n.length;r++)i+=n[r].getZIndex();return t=Math.round(Math.log(i/4)),t>5&&(t=5),{text:i,index:t}});$(".collapsible").collapsible();e();loaderStop()}})}function it(){var n=$("#filter input[name='__RequestVerificationToken'],#Insurance, #Ubicacion, #Especialidad, #Sex, #HighlightInsurance, #MinTime, #MaxTime").serializeArray(),i=$("#MinDate,#MaxDate").serializeArray(),t;return i.forEach(function(t){t.value!==""&&n.push({name:t.name,value:moment(t.value,momentFormat).toJSON().replace("Z","")})}),t=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],t.forEach(function(t){n.push({name:t,value:$("#"+t).prop("checked")})}),n}function h(){$.post("/Patients/Search/MapList",it(),tt)}function rt(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){var i=r.getBounds(),u=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);o=new google.maps.Marker({position:u,map:r,title:"Mi posición actual",icon:"https://chart.apis.google.com/chart?chst=d_map_xpin_icon&chld=pin_star|wc-male|042037|2A4F6E"});n.push(o);i.extend(u);r.fitBounds(i)})}function u(){loaderStart();b();h()}function c(n,t){var r=n,i=$(t).select2("data"),u;i.length>0&&(u=i.length>1?" +"+(i.length-1):"",r=i[0].text.substring(0,8)+"&hellip;"+u);$("#btn"+n).html(r)}function ut(n){return n%6?0:1}var v=["Particular","FONASA","Banmédica","Colmena","Consalud","CruzBlanca","Nueva Masvida","Vida Tres"],n=[],i,r=new google.maps.Map(document.getElementById("map"),{mapTypeControl:!1,scaleControl:!0,streetViewControl:!1,fullscreenControl:!1,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER}}),t={},o,l,a,s,f;h();$("#toggle-center").click(function(){var t=this.firstElementChild;t.innerHTML=="location_off"?(t.innerHTML="location_on",rt()):(t.innerHTML="location_off",n.pop(),o.setMap(null),e())});$("#toggle-view").click(function(){$("#map-view").css("display")==="block"?($(this).html("volver al mapa"),$.each(t,function(n,t){$("#"+n).html(t.content)})):$(this).html("ver como lista");$("#map-view").slideToggle();$("#list-view").slideToggle();setTimeout(e,400)});$.getJSON("/Patients/Search/NameList",function(n){l=n;$("#search-filter").autocomplete({data:n,limit:10,onAutocomplete:function(n){console.log(n);var t=parseInt(l[n].replace(/.*\//g,"").replace(/\..*/g,""));agendar(t,null)}})});a=document.getElementById("time-slider");noUiSlider.create(a,{start:[0,24],connect:!0,step:1,orientation:"horizontal",margin:1,range:{min:0,max:24},format:{to:function(n){return Math.ceil(n)},from:function(n){return Number(n.replace(/\D/g,""))}},pips:{mode:"steps",density:4,filter:ut,format:{to:function(n){var t="AM";return n>12&&(n-=12,n!==24&&(t="PM")),Math.ceil(n)+" "+t},from:function(n){return Number(n.replace(/\D/g,""))}}}}).on("set",function(n,t){t?$("#MaxTime").val(n[t]===24?"":n[t]):$("#MinTime").val(n[t]===0?"":n[t])});s=new Date;$(".datepicker").datepicker({firstDay:1,format:datepickerFormat,autoClose:!0,minDate:s,maxDate:new Date($("#Last").val()),i18n:{months:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthsShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Set","Oct","Nov","Dic"],weekdays:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],weekdaysShort:["Dom","Lun","Mar","Mie","Jue","Vie","Sab"],weekdaysAbbrev:["D","L","M","M","J","V","S"],cancel:"Cancelar",clear:"Limpiar",done:"Ok"},showClearBtn:!0});$("#MinDate").change(function(){var n=M.Datepicker.getInstance(document.getElementById("MaxDate"));n.options.minDate=$(this).val()===""?s:moment($(this).val(),momentFormat).toDate()});f=$("#dates-col").detach();$("#dates-pane").modal({onOpenEnd:function(){$(this.el).find(".dates-div").append(f)},onCloseStart:u});$.getJSON("/Patients/Search/FilterLists",function(n){var e=$("#Especialidad").select2({theme:"material",placeholder:"Seleccione especialidades",data:n.esp}),t,r,i,o;e.change(function(){c("Especialidad",this)});t=$("#especialities-col").detach();$("#specialties-pane").modal({onOpenEnd:function(){$(this.el).find(".especialities-div").append(t)},onCloseStart:u});r=$("#Ubicacion").select2({theme:"material",placeholder:"Seleccione ubicaciones",data:n.loc});r.change(function(){c("Ubicacion",this)});i=$("#locations-col").detach();$("#locations-pane").modal({onOpenEnd:function(){$(this.el).find(".locations-div").append(i)},onCloseStart:u});$("#filters-pane").modal({onOpenEnd:function(){$(this.el).find(".especialities-div").append(t);$(this.el).find(".locations-div").append(i);$(this.el).find(".dates-div").append(f)},onCloseStart:u}).find(".especialities-div").append(t).find(".locations-div").append(i).find(".dates-div").append(f);o=$("#Sex").select2({theme:"material",maximumSelectionLength:1,placeholder:"Seleccione sexo del profesional médico"});$("input.select2-search__field").addClass("browser-default")})}var momentFormat="DD MMMM YYYY",datepickerFormat="dd mmmm, yyyy";