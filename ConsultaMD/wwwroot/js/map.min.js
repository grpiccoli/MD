function min(n){return Math.min.apply(Math,n)}function isNullOrWhitespace(n){return typeof n=="undefined"||n==null?!0:n.replace(/\s/g,"").length<1}function agendar2(n){var i=$("#MinDate").val(),r=$("#Last").val(),u=moment(r).toDate().getFullYear(),t;i=isNullOrWhitespace(i)?moment(dateToday).toJSON().replace("Z",""):moment(i).toJSON().replace("Z","");t=$("#MaxDate").val();t=isNullOrWhitespace(t)?moment(r).toJSON().replace("Z",""):moment(t).toJSON().replace("Z","");console.log(n);$.post("/Patients/Search/GetDates",{__RequestVerificationToken:$("input[name='__RequestVerificationToken']").val(),mdId:n,minDate:i,maxDate:t},function(t){console.log(n);var i=M.Datepicker.init(document.getElementById("Date"),{firstDay:1,autoClose:!0,minDate:dateToday,showDaysInNextAndPreviousMonths:!0,maxDate:new Date($("#Last").val()),defaultDate:moment(min(t),"YYYYMMDD").toDate(),yearRange:[yr,u],setDefaultDate:!0,disableDayFn:function(n){var i=parseInt(moment(n,moment.ISO_8601).format("YYYYMMDD"));return t.indexOf(i)===-1},i18n:{months:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthsShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Set","Oct","Nov","Dic"],weekdays:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],weekdaysShort:["Dom","Lun","Mar","Mie","Jue","Vie","Sab"],weekdaysAbbrev:["D","L","M","M","J","V","S"],cancel:"Cancelar",clear:"Limpiar",done:"Ok"},onSelect:function(t){console.log(n);var i=moment(t,moment.ISO_8601).toJSON().replace("Z","");$.post("/Patients/Search/TimeSlots",{__RequestVerificationToken:$("input[name='__RequestVerificationToken']").val(),startDate:i,mdId:n},function(n){var t="",i="";$.each(n,function(n,r){var u="<tr>"+("<td>"+r.startTime+"<\/td>")+"<td>"+('<button class="time-select btn clinic-desc" data-id="'+r.id+'" class="btn waves-effect waves-teal right-align">SELECCIONAR<\/button>')+"<\/td><\/tr>";~r.startTime.indexOf("a.")?t+=u:i+=u});mañanaTable="<table>"+t+"<\/table>";$("#BookingMorning").html(mañanaTable);tardeTable="<table>"+i+"<\/table>";$("#BookingAfternoon").html(tardeTable);M.Sidenav.getInstance(document.getElementById("slide-action")).close();$("#map-view").slideUp();$("#list-view").slideUp();$("#date-view").slideDown();$("#toggle-view").html("volver al mapa")})}});return i.open(),!1})}function agendar(n,t){var u=$("#Insurance, #Ubicacion, #MinTime, #MaxTime").serialize(),f=$("#MinDate,#MaxDate").serializeArray(),i=[u],r;return i.push("MdId="+t),i.push("Last="+$("#Last").val()),f.forEach(function(n){n.value!==""&&i.push(n.name+"="+moment(n.value).toJSON().replace("Z",""))}),r=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],r.forEach(function(n){var t=$("#"+n).prop("checked");typeof t!="undefined"&&i.push(n+"="+t)}),window.location.href="/Patients/Search/DoctorDetails/"+n+"?"+i.join("&"),!1}function initMap(){function s(){for(var f,i=new google.maps.LatLngBounds,n=0,u=t;n<u.length;n++)f=u[n],i.extend(f.getPosition());r.fitBounds(i)}function p(t,i){google.maps.event.addListener(t,"click",function(){$("#slide-header").html(n[i].header);$("#slide-content").html(n[i].content);setTimeout(function(){f.open();M.Tabs.init(document.querySelectorAll("#slide-action .tabs"));M.Tooltip.init(document.querySelectorAll("#slide-action .tooltipped"))},500)})}function w(n){for(var u,i=0,r=t;i<r.length;i++)u=r[i],u.setMap(n)}function b(){w(null)}function k(){b();t=[]}function l(n){return n.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1.")}function d(n,t){var u='<div id="'+n.cardId+'sp" class="tab-content esp">',f="",i='<div id="'+n.cardId+'insr" class="tab-content mis">',a='<li class="tab"><a class="mis" href="#'+n.cardId+'insr">Convenios<\/a><\/li>',v='<li class="tab"><a class="esp" href="#'+n.cardId+'sp">Especialidad<\/a><\/li>',h,r,e,c,o,s;if(n.insurances.length!==0){for(h=n.insurances.length>1?"s":"",i+="<label>Convenio"+h+":<\/label><ul>",r=0,e=n.insurances;r<e.length;r++)c=e[r],o=y[c],i+='<li><a class="btn tooltipped" data-tooltip="'+o+'"><img src="/img/mi/'+o+'-icon.min.png"/><\/a><\/li>';i+="<\/ul>"}return i+="<\/div>",n.especialidad!==null&&(f="Dr"+(n.sex?"":"a")+".",u+="<label>Esp.<\/label><span>"+n.especialidad+"<\/span>"),u+="<\/div>",s='<p class="address">'+t.address,s+=isNullOrWhitespace(n.office)?"<\/li>":" <span>"+n.office+"<\/span><\/p>",'<div class="col s12 m6 l4"><div class="card horizontal sticky-action"><div class="card-image">'+('<img src="/img/doc/'+n.run+'.min.jpg"/>')+'<\/div><div class="card-stacked"><div class="card-content">'+('<span class="card-title activator">'+f+" "+n.dr+"<\/span>")+'<\/div><div class="card-tabs"><ul class="tabs tabs-fixed-width">'+('<li class="tab"><a class="time" href="#'+n.cardId+'next">Prox. Hora<\/a><\/li>')+('<li class="tab"><a class="addr" href="#'+n.cardId+'addr">Dirección<\/a><\/li>')+('<li class="tab"><a class="price" href="#'+n.cardId+'prce">Valor Particular<\/a><\/li>')+a+v+'<\/ul><\/div><div class="card-content grey lighten-4">'+('<div id="'+n.cardId+'next" class="tab-content time">'+n.hora+"<\/div>")+('<div id="'+n.cardId+'addr" class="tab-content addr">'+s+"<\/div>")+('<div id="'+n.cardId+'prce" class="tab-content price"><span><i class="material-icons left">attach_money<\/i>'+l(n.price)+"<\/span><\/div>")+i+u+'<\/div><div class="card-action center">'+('<a href="#" onclick="agendar2('+n.cardId+')">Agendar<\/a>')+'<\/div><\/div><div class="card-reveal"><span class="card-title">'+('<i class="material-icons right">close<\/i>'+f+" "+n.dr)+"<\/span>"+i+"<label>Valor Particular:<\/label>"+("<span>$"+l(n.price)+"<\/span>")+"<\/div><\/div><\/div>"}function g(i){i.place.cId in n||(n[i.place.cId]={},n[i.place.cId].header='<div class="col s12 m6"><div class="card m-0"><div class="card-image">'+('<img class="activator placeimg" src="https://maps.googleapis.com/maps/api/place/photo?maxwidth=300&photoreference='+i.place.photoId+'&key=AIzaSyDkCLRdkB6VyOXs-Uz_MFJ8Ym9Ji1Xp3rA">')+('<span class="card-title activator"><b>'+i.place.name+"<\/b><\/span>")+'<\/div><div class="card-content"><span class="card-title activator grey-text text-darken-4">Ver detalles<i class="material-icons right">more_vert<\/i><\/span><\/div><div class="card-reveal">'+('<span class="card-title grey-text text-darken-4">'+i.place.name+'<i class="material-icons right">close<\/i><\/span>')+("<p><b>Dirección<\/b>: "+i.place.address+'.<a href="https://maps.google.com/?cid='+i.place.cId+'"><i class="material-icons">location_on<\/i><\/a><\/p>')+"<\/div><\/div><\/div><\/div>",n[i.place.cId].list='<div class="col s12"><h5>'+i.place.name+"<\/h5><p>"+i.place.address+'<\/p><hr/><\/div><div id="'+i.place.cId+'" class="list-place"><\/div>');$("#list").append(n[i.place.cId].list);var u=0,f=.5,o="";$.each(i.items,function(){this.dr in e||(e[this.dr]="/img/doc/"+this.run+".min.jpg");var n=d(this,i.place);o+=n;u++;f===.5&&this.match&&(f=1)});n[i.place.cId].content=o;var s=new google.maps.Marker({position:new google.maps.LatLng({lat:i.place.latitude,lng:i.place.longitude}),map:r,title:i.place.name+"\n"+i.place.address,icon:"https://chart.apis.google.com/chart?chst=d_map_spin&chld=1|0|1d999e|16|b|"+u,zIndex:u,opacity:f});t.push(s);p(s,i.place.cId)}function nt(n){var u=n.length;u===0&&(loaderStop(),$("button").removeAttr("disabled"),alert("No hay resultados para los filtros seleccionados"),typeof i!="undefined"&&i.clearMarkers());$("#list").empty();e={};$.each(n,function(){var n,f;g(this);--u||(s(),loaderStop(),n=document.getElementById("search-filter"),M.Autocomplete.init(n,{data:e,limit:10,onAutocomplete:function(n){var t=parseInt(e[n].replace(/.*\//g,"").replace(/\..*/g,""));agendar(t,null)}}),$("#close-search").click(function(){$(n).val("")}),typeof i!="undefined"&&i.clearMarkers(),f={gridSize:40,imagePath:"/img/cluster/m"},i=new MarkerClusterer(r,t,f),i.setCalculator(function(n){for(var f,t=1,i=0,r=0,u=n;r<u.length;r++)f=u[r],i+=f.getZIndex();return t=Math.round(Math.log(i/4)),t>5&&(t=5),{text:i,index:t}}),M.Collapsible.init(document.querySelectorAll(".collapsible")),$("button").removeAttr("disabled"))})}function tt(){var n=$("#filter input[name='__RequestVerificationToken'],#Insurance, #Ubicacion, #Especialidad, #Sex, #HighlightInsurance, #MinTime, #MaxTime").serializeArray(),i=$("#MinDate,#MaxDate").serializeArray(),t;return i.forEach(function(t){t.value!==""&&n.push({name:t.name,value:moment(t.value).toJSON().replace("Z","")})}),t=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],t.forEach(function(t){n.push({name:t,value:$("#"+t).prop("checked")})}),n}function a(){loaderStart();$("button").prop("disabled",!0);$.post("/Patients/Search/MapList",tt(),nt)}function it(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(n){var i=r.getBounds(),u=new google.maps.LatLng(n.coords.latitude,n.coords.longitude);h=new google.maps.Marker({position:u,map:r,title:"Mi posición actual",icon:"https://chart.apis.google.com/chart?chst=d_map_xpin_icon&chld=pin_star|wc-male|042037|2A4F6E"});t.push(h);i.extend(u);r.fitBounds(i)})}function rt(){o&&(k(),a(),o=!1)}function v(n){var i=$(n.target).attr("id"),r=i,t=$(n.target).select2("data"),u;t.length>0&&(u=t.length>1?" +"+(t.length-1):"",r=t[0].text.substring(0,8)+"&hellip;"+u);$("#btn"+i).html(r);o=!0}function ut(n){return n%6?0:1}var y=["Particular","FONASA","Banmédica","Colmena","Consalud","CruzBlanca","Nueva Masvida","Vida Tres"],t=[],i,r=new google.maps.Map(document.getElementById("map"),{mapTypeControl:!1,scaleControl:!0,streetViewControl:!1,fullscreenControl:!1,gestureHandling:"greedy",zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER}}),n={},f=M.Sidenav.init(document.getElementById("slide-action"),{draggable:!0,onCloseEnd:function(){[].forEach.call(document.querySelectorAll("#slide-action .tabs"),function(n){M.Tabs.getInstance(n).destroy()});[].forEach.call(document.querySelectorAll("#slide-action .tooltipped"),function(n){M.Tooltip.getInstance(n).destroy()})}}),e,h,o,u,c;document.querySelectorAll("#slide-action ul").forEach(function(n){n.addEventListener("touchstart",function(){f.options.draggable=!1});n.addEventListener("touchmove",function(){f.options.draggable=!1});n.addEventListener("drag",function(){f.options.draggable=!1});n.addEventListener("touchend",function(){f.options.draggable=!0})});a();$("#toggle-center").click(function(){var n=this.firstElementChild;n.innerHTML=="location_off"?(n.innerHTML="location_on",it()):(n.innerHTML="location_off",t.pop(),h.setMap(null),s())});$("#toggle-view").click(function(){$("#date-view").slideUp();$("#map-view").css("display")==="block"?($(this).html("volver al mapa"),$.each(n,function(n){$("#"+n).html(this.content)}),M.Tooltip.init(document.querySelectorAll("#list .tooltipped")),$("#map-view").slideUp(),$("#list-view").slideDown(),M.Tabs.init(document.querySelectorAll("#list .tabs"))):($("#map-view").slideDown(),$("#list-view").slideUp(),$(this).html("ver como lista"),setTimeout(s,400),setTimeout(function(){[].forEach.call(document.querySelectorAll("#list .tabs"),function(n){M.Tabs.getInstance(n).destroy()});[].forEach.call(document.querySelectorAll("#list .tooltipped"),function(n){M.Tooltip.getInstance(n).destroy()});$("#list .list-place").html("")},200))});o=!1;noUiSlider.create(document.getElementById("time-slider"),{start:[0,24],connect:!0,step:1,orientation:"horizontal",margin:6,range:{min:0,max:24},format:{to:function(n){return Math.ceil(n)},from:function(n){return Number(n.replace(/\D/g,""))}},pips:{mode:"steps",density:4,filter:ut,format:{to:function(n){var t="AM";return n>=12&&(n!==24&&(t="PM"),n!==12&&(n-=12)),Math.ceil(n)+" "+t},from:function(n){return Number(n.replace(/\D/g,""))}}}}).on("set",function(n,t){t?$("#MaxTime").val(n[t]===24?"":n[t]):$("#MinTime").val(n[t]===0?"":n[t])});M.Datepicker.init(document.querySelectorAll(".datepicker"),{firstDay:1,format:datepickerFormat,autoClose:!0,minDate:dateToday,maxDate:new Date($("#Last").val()),i18n:{months:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthsShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Set","Oct","Nov","Dic"],weekdays:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],weekdaysShort:["Dom","Lun","Mar","Mie","Jue","Vie","Sab"],weekdaysAbbrev:["D","L","M","M","J","V","S"],cancel:"Cancelar",clear:"Limpiar",done:"Ok"},showClearBtn:!0});$("#MinDate").change(function(){var n=M.Datepicker.getInstance(document.getElementById("MaxDate"));n.options.minDate=$(this).val()===""?dateToday:moment($(this).val()).toDate()});u=M.Modal.init(document.getElementById("filters-pane"),{onCloseStart:rt});$("#filter-action").click(function(n){n.preventDefault();u.close()});$("#filter-clear").click(function(n){n.preventDefault();window.location.reload()});$("#filter input").change(function(){o=!0});$(".fltbtn").click(function(n){var t=$(n.target).attr("id");switch(t){case"btnEspecialidad":$(".fltcol").hide();u.open();$("#especialities-col").fadeIn();$("#especialities-col input.select2-search__field").trigger("keyup");break;case"btnUbicacion":$(".fltcol").hide();u.open();$("#locations-col").fadeIn();$("#locations-col input.select2-search__field").trigger("keyup");break;case"btnFechaHora":$(".fltcol").hide();u.open();$("#dates-col").fadeIn();$("#dates-col input.select2-search__field").trigger("keyup");break;case"all1":case"all2":u.open();$(".fltcol").fadeIn();$("#filters-pane input.select2-search__field").trigger("keyup")}});c=M.FormSelect.init(document.getElementById("show"));c.el.addEventListener("change",function(){$("li.tab a").removeClass("active");var t=c.el,n=t.options[t.selectedIndex].value,r=$("li.tab a."+n).addClass("active"),i=0;(n==="esp"||n==="mis")&&(i+=200);r.parent().parent().animate({scrollLeft:i});M.Tabs.init(document.querySelectorAll(".tabs"))});$.post("/Patients/Search/FilterLists",$("#filter input[name='__RequestVerificationToken']").serializeArray(),function(n){$("#Especialidad").select2({theme:"material",placeholder:"Seleccione especialidades",data:n.esp}).change(v);$("#Ubicacion").select2({theme:"material",placeholder:"Seleccione ubicaciones",data:n.loc}).change(v);$("#Sex").select2({theme:"material",maximumSelectionLength:1,placeholder:"Seleccione sexo del profesional médico"});$("input.select2-search__field").addClass("browser-default")})}var dateToday=new Date,yr=dateToday.getFullYear(),datepickerFormat="dddd dd mmmm, yyyy",mañanaTable,tardeTable;$("#date-view").on("click","button.time-select",function(){$.post("./Reservation",{id:$(this).data("id"),__RequestVerificationToken:$("input[name='__RequestVerificationToken']").val()})});